<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberShield Sentinel - Adaptive Corporate Security Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #2563eb; --primary-dark: #1d4ed8; --secondary: #8b5cf6; --accent: #ec4899; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --light: #f8fafc; --dark: #1e293b; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); min-height: 100vh; }
        .screen { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .screen.active { display: flex; opacity: 1; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.5); }
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s ease; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .btn-secondary:hover { background: #f0f7ff; transform: translateY(-2px); }
        .progress-bar { height: 0.5rem; border-radius: 1rem; background: #e2e8f0; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 1rem; background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%); transition: width 0.5s ease; }
        .conversation-container { max-height: 400px; overflow-y: auto; padding: 1rem; background: #f8fafc; border-radius: 1rem; margin-bottom: 1.5rem; }
        .message { margin-bottom: 1rem; display: flex; }
        .message-bot { justify-content: flex-start; }
        .message-user { justify-content: flex-end; }
        .message-content { padding: 0.75rem 1rem; border-radius: 1rem; max-width: 80%; }
        .message-bot .message-content { background: white; border: 1px solid #e2e8f0; }
        .message-user .message-content { background: var(--primary); color: white; }
        .option-btn { display: inline-block; padding: 0.75rem 1.25rem; margin: 0.25rem; background: white; border: 2px solid #e2e8f0; border-radius: 0.75rem; cursor: pointer; transition: all 0.2s ease; font-weight: 500; }
        .option-btn:hover { background: #f1f5f9; border-color: #3b82f6; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); }
        .status-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: capitalize;}
        .status-completed { background-color: #dcfce7; color: #166534; }
        .status-pending { background-color: #ffedd5; color: #9a3412; }
        .status-in_progress { background-color: #dbeafe; color: #1e40af; }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <nav id="navbar" class="bg-white shadow-sm py-4 px-6 flex justify-between items-center hidden">
        <div class="flex items-center">
            <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center mr-3"><i class="fas fa-shield-alt text-white text-lg"></i></div>
            <h1 class="text-xl font-bold text-blue-600">CyberShield Sentinel</h1>
        </div>
        <div class="flex items-center space-x-4">
            <span id="nav-user-name" class="text-gray-700 font-medium"></span>
            <button id="logout-btn" class="text-gray-600 hover:text-blue-600"><i class="fas fa-sign-out-alt"></i><span class="hidden md:inline ml-1">Logout</span></button>
        </div>
    </nav>
    
    <main class="flex-1 flex items-center justify-center p-4 py-8">
        <div id="login-screen" class="screen active w-full max-w-md mx-auto flex-col justify-center">
            <div class="card p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 rounded-xl bg-blue-600 flex items-center justify-center mx-auto mb-4"><i class="fas fa-shield-alt text-white text-2xl"></i></div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">CyberShield Sentinel</h1>
                    <p class="text-gray-600">Corporate Security Assessment Platform</p>
                </div>
                <div id="login-error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 hidden" role="alert">
                  <strong class="font-bold">Login Failed!</strong><span class="block sm:inline" id="login-error-message"></span>
                </div>
                <div class="mb-6"><label class="block text-gray-700 font-medium mb-2">Email</label><input type="email" id="login-email" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="you@company.com"></div>
                <div class="mb-6"><label class="block text-gray-700 font-medium mb-2">Password</label><input type="password" id="login-password" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="••••••••"></div>
                <button id="login-btn" class="btn btn-primary w-full mb-4">Sign In <i class="fas fa-arrow-right ml-2"></i></button>
                <div class="text-center"><p class="text-sm text-gray-600">Demo Credentials:</p><p class="text-xs text-gray-500 mt-1">Admin: admin@company.com / password<br>Employee: john@company.com / password</p></div>
            </div>
        </div>

        <div id="admin-dashboard" class="screen w-full max-w-6xl mx-auto flex-col">
            <div class="card p-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-8">Admin Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="p-6 bg-blue-50 rounded-lg"><h3 class="font-bold text-lg mb-2">Total Employees</h3><p class="text-3xl font-bold text-blue-600" id="total-employees">--</p></div>
                    <div class="p-6 bg-orange-50 rounded-lg"><h3 class="font-bold text-lg mb-2">Pending Assessments</h3><p class="text-3xl font-bold text-orange-600" id="pending-assessments">--</p></div>
                    <div class="p-6 bg-green-50 rounded-lg"><h3 class="font-bold text-lg mb-2">Avg. Security Score</h3><p class="text-3xl font-bold text-green-600" id="avg-security-score">--%</p></div>
                </div>
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Assign New Assessment</h2>
                    <div class="bg-gray-50 p-6 rounded-xl">
                        <div id="assign-success" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4 hidden" role="alert">Assessment assigned successfully!</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div><label class="block text-gray-700 font-medium mb-2">Select Employee</label><select id="assign-employee" class="w-full p-3 border border-gray-300 rounded-lg"><option value="">-- Loading Employees --</option></select></div>
                            <div><label class="block text-gray-700 font-medium mb-2">Due Date</label><input type="date" id="due-date" class="w-full p-3 border border-gray-300 rounded-lg"></div>
                        </div>
                        <button id="assign-assessment-btn" class="btn btn-primary"><i class="fas fa-tasks mr-2"></i> Assign Assessment</button>
                    </div>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Employee Risk Overview</h2>
                    <div class="bg-gray-50 p-6 rounded-xl overflow-x-auto">
                        <table class="w-full"><thead class="border-b"><tr class="text-left"><th class="p-3 font-medium">Employee</th><th class="p-3 font-medium">Department</th><th class="p-3 font-medium">Last Score</th><th class="p-3 font-medium">Status</th></tr></thead><tbody id="employee-table-body"></tbody></table>
                    </div>
                </div>
            </div>
        </div>

        <div id="employee-dashboard" class="screen w-full max-w-4xl mx-auto flex-col">
            <div class="card p-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome, <span id="employee-name"></span></h1>
                <p class="text-gray-600 mb-8">Department: <span id="employee-department"></span></p>
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Your Assigned Assessments</h2>
                    <div class="space-y-4" id="assigned-assessments-list"></div>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Your Past Reports</h2>
                    <div class="space-y-4" id="past-reports-list"></div>
                </div>
            </div>
        </div>

        <div id="conversation-screen" class="screen w-full max-w-2xl mx-auto flex-col justify-center">
            <div class="card p-8">
                <div class="flex items-center justify-between mb-6"><h2 class="text-xl font-bold text-gray-800">Security Assessment</h2>
                    <div class="w-40"><div class="text-xs text-gray-600 text-right mb-1"><span id="progress-percent">0%</span> Complete</div><div class="progress-bar"><div id="progress-fill" class="progress-fill" style="width: 0%"></div></div></div>
                </div>
                <div class="conversation-container" id="conversation-container"></div>
                <div id="options-container" class="flex flex-wrap justify-center mb-4"></div>
            </div>
        </div>
        <div id="report-screen" class="screen w-full max-w-4xl mx-auto flex-col">
            <div class="card p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Your Security Assessment Report</h1>
                    <p class="text-gray-600">Generated on <span id="report-date"></span> for <span id="report-user-name"></span></p>
                </div>
        
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 p-6 rounded-xl text-center flex flex-col justify-center">
                        <p class="text-6xl font-bold text-blue-700" id="report-score">--%</p>
                        <h3 class="font-semibold text-lg mb-1">Overall Score</h3>
                        <div id="report-risk-level" class="font-bold text-lg"></div>
                    </div>
                    <div class="md:col-span-2 bg-gray-50 p-6 rounded-xl">
                        <h3 class="font-semibold text-lg mb-4">Category Scores</h3>
                        <div id="report-category-scores" class="space-y-4"></div>
                    </div>
                </div>
        
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Behavioral Pattern Analysis</h2>
                    <div id="report-behavioral-patterns" class="bg-gray-50 p-6 rounded-xl grid grid-cols-1 md:grid-cols-2 gap-4">
                        </div>
                </div>
        
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Actionable Recommendations</h2>
                    <div id="report-recommendations" class="space-y-3"></div>
                </div>
        
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">What You're Doing Well</h2>
                    <div class="bg-green-50 p-6 rounded-xl">
                        <ul id="report-strengths" class="list-disc list-inside space-y-2 text-green-800"></ul>
                    </div>
                </div>
        
                <div class="text-center">
                    <button id="back-to-dashboard-btn" class="btn btn-primary"><i class="fas fa-arrow-left mr-2"></i> Back to Dashboard</button>
                </div>
            </div>
        </div>
        
    </main>
    
    <script>
        const state = { currentScreen: 'login-screen', user: null, token: null, currentSessionId: null, totalQuestions: 10 };
        const API_BASE_URL = 'http://localhost:5000/api';

        const ui = {
            screens: document.querySelectorAll('.screen'),
            navbar: document.getElementById('navbar'),
            navUserName: document.getElementById('nav-user-name'),
            login: { screen: document.getElementById('login-screen'), emailInput: document.getElementById('login-email'), passwordInput: document.getElementById('login-password'), loginBtn: document.getElementById('login-btn'), error: document.getElementById('login-error'), errorMessage: document.getElementById('login-error-message'), },
            admin: { screen: document.getElementById('admin-dashboard'), totalEmployees: document.getElementById('total-employees'), pendingAssessments: document.getElementById('pending-assessments'), avgScore: document.getElementById('avg-security-score'), assignEmployeeSelect: document.getElementById('assign-employee'), dueDateInput: document.getElementById('due-date'), assignBtn: document.getElementById('assign-assessment-btn'), employeeTableBody: document.getElementById('employee-table-body'), assignSuccess: document.getElementById('assign-success'), },
            employee: { screen: document.getElementById('employee-dashboard'), name: document.getElementById('employee-name'), department: document.getElementById('employee-department'), assignedList: document.getElementById('assigned-assessments-list'), pastReportsList: document.getElementById('past-reports-list'), },
            assessment: { screen: document.getElementById('conversation-screen'), conversationContainer: document.getElementById('conversation-container'), optionsContainer: document.getElementById('options-container'), progressPercent: document.getElementById('progress-percent'), progressFill: document.getElementById('progress-fill'), },
            logoutBtn: document.getElementById('logout-btn'),
        };

        async function apiCall(endpoint, method = 'GET', body = null) {
            const headers = { 'Content-Type': 'application/json' };
            if (state.token) headers['Authorization'] = `Bearer ${state.token}`;
            const options = { method, headers, body: body ? JSON.stringify(body) : null };
            const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
            const data = await response.json();
            if (!response.ok) throw new Error(data.error || `HTTP error! status: ${response.status}`);
            return data;
        }
        
        function showScreen(screenId) {
            ui.screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            state.currentScreen = screenId;
            ui.navbar.classList.toggle('hidden', screenId === 'login-screen');
        }

        async function handleLogin() {
            const email = ui.login.emailInput.value.trim();
            const password = ui.login.passwordInput.value;
            ui.login.error.classList.add('hidden');
            if (!email || !password) { ui.login.errorMessage.textContent = 'Please enter both email and password.'; ui.login.error.classList.remove('hidden'); return; }
            try {
                const data = await apiCall('/auth/login', 'POST', { email, password });
                state.token = data.token; state.user = data.user;
                ui.navUserName.textContent = state.user.name;
                if (state.user.role === 'admin') { renderAdminDashboard(); showScreen('admin-dashboard'); } 
                else { renderEmployeeDashboard(); showScreen('employee-dashboard'); }
            } catch (err) { ui.login.errorMessage.textContent = err.message; ui.login.error.classList.remove('hidden'); }
        }
        
        function handleLogout() {
            state.token = null; state.user = null;
            ui.login.emailInput.value = ''; ui.login.passwordInput.value = '';
            showScreen('login-screen');
        }

        async function renderAdminDashboard() {
            try {
                const [dashboardData, employees] = await Promise.all([ apiCall('/admin/dashboard'), apiCall('/admin/employees') ]);
                ui.admin.totalEmployees.textContent = dashboardData.stats.totalEmployees;
                ui.admin.pendingAssessments.textContent = dashboardData.stats.pendingAssessments;
                ui.admin.avgScore.textContent = `${dashboardData.stats.avgSecurityScore}%`;
                ui.admin.employeeTableBody.innerHTML = employees.map(emp => `
                    <tr class="border-b hover:bg-gray-50 text-sm">
                        <td class="p-3">${emp.name}</td>
                        <td class="p-3">${emp.department}</td>
                        <td class="p-3">${emp.last_score ? emp.last_score + '%' : 'N/A'}</td>
                        <td class="p-3"><span class="status-badge status-${(emp.assignment_status || 'completed').replace(' ', '_')}">${emp.assignment_status || 'Completed'}</span></td>
                    </tr>`).join('');
                ui.admin.assignEmployeeSelect.innerHTML = '<option value="">-- Select Employee --</option>' + employees.map(emp => `<option value="${emp.email}">${emp.name} (${emp.department})</option>`).join('');
            } catch (error) { console.error('Failed to load admin dashboard:', error); alert('Could not load admin data.'); }
        }

        async function handleAssignAssessment() {
            const user_id = ui.admin.assignEmployeeSelect.value;
            const due_date = ui.admin.dueDateInput.value;
            if (!user_id || !due_date) return alert('Please select an employee and a due date.');
            try {
                await apiCall('/assign', 'POST', { user_id, due_date });
                ui.admin.assignSuccess.classList.remove('hidden');
                setTimeout(() => ui.admin.assignSuccess.classList.add('hidden'), 3000);
                renderAdminDashboard();
            } catch (error) { alert(`Failed to assign assessment: ${error.message}`); }
        }

        async function renderEmployeeDashboard() {
            ui.employee.name.textContent = state.user.name;
            ui.employee.department.textContent = state.user.department;
            try {
                const data = await apiCall('/employee/dashboard');
                ui.employee.assignedList.innerHTML = data.assignments.filter(a => a.status === 'pending' || a.status === 'in_progress').map(a => {
                    const isPending = a.status === 'pending';
                    return `
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold">${a.assessment_type} Assessment</h4>
                            <p class="text-sm text-gray-600">Due: ${new Date(a.due_date).toLocaleDateString()} <span class="status-badge status-${a.status.replace(' ', '_')}">${a.status}</span></p>
                        </div>
                        <button class="btn ${isPending ? 'btn-primary' : 'btn-secondary'} btn-sm start-assessment-btn" data-assignment-id="${a.assignment_id}">
                            ${isPending ? 'Start Now' : 'Resume'}
                        </button>
                    </div>`;
                }).join('') || '<p class="text-gray-500">No pending assessments. Great job!</p>';
                
                ui.employee.pastReportsList.innerHTML = data.assessments.filter(a => a.status === 'completed' && a.overall_score != null).map(a => `
                    <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold">Assessment Report</h4>
                            <p class="text-sm text-gray-600">Completed: ${new Date(a.completed_date).toLocaleDateString()}</p>
                        </div>
                        <button class="btn btn-secondary btn-sm view-report-btn" data-session-id="${a.session_id}">
                            View Report (${a.overall_score}%)
                        </button>
                    </div>`).join('') || '<p class="text-gray-500">No past reports found.</p>';
            } catch (error) { alert(`Failed to load your dashboard: ${error.message}`); }
        }
                
        let questionHistory = [];
        async function startAssessment(assignmentId) {
            if (!assignmentId) return alert('Invalid assignment selected.');
            try {
                const data = await apiCall('/assessments/start', 'POST', { assignmentId });
                state.currentSessionId = data.session_id;
                questionHistory = [data.current_question];
                renderConversation();
                // *** THIS IS THE CORRECTED LINE ***
                showScreen('conversation-screen'); 
            } catch (error) { alert(`Could not start assessment: ${error.message}`); }
        }
        
        function renderConversation() {
            const currentQuestion = questionHistory[questionHistory.length - 1];
            ui.assessment.conversationContainer.innerHTML = questionHistory.map(q => `
                <div class="message message-bot"><div class="message-content"><p>${q.text}</p></div></div>
                ${q.userAnswer ? `<div class="message message-user"><div class="message-content"><p>${q.userAnswer}</p></div></div>` : ''}`
            ).join('');
            ui.assessment.optionsContainer.innerHTML = currentQuestion.options.map(option => `<div class="option-btn" data-answer="${option}">${option}</div>`).join('');
            const progress = Math.min(100, Math.round(((questionHistory.length - 1) / state.totalQuestions) * 100));
            ui.assessment.progressPercent.textContent = `${progress}%`;
            ui.assessment.progressFill.style.width = `${progress}%`;
            ui.assessment.conversationContainer.scrollTop = ui.assessment.conversationContainer.scrollHeight;
        }

        async function handleOptionSelect(e) {
            if (!e.target.matches('.option-btn')) return;
            const answer = e.target.dataset.answer;
            const currentQuestion = questionHistory[questionHistory.length - 1];
            currentQuestion.userAnswer = answer;
            try {
                const data = await apiCall(`/assessments/${state.currentSessionId}/answer`, 'POST', { questionId: currentQuestion.id, answer });
                if (data.is_complete) {
                    alert("Assessment Complete!");
                    renderEmployeeDashboard();
                    showScreen('employee-dashboard');
                } else {
                    questionHistory.push(data.next_question);
                    renderConversation();
                }
            } catch (error) { alert(`Error submitting answer: ${error.message}`); }
        }
        const uiReport = {
            screen: document.getElementById('report-screen'),
            date: document.getElementById('report-date'),
            score: document.getElementById('report-score'),
            summary: document.getElementById('report-summary'),
            backBtn: document.getElementById('back-to-dashboard-btn'),
        };

        async function viewReport(sessionId) {
            if (!sessionId) return;
            try {
                const data = await apiCall(`/assessments/${sessionId}/report`);
                const report = data.report;

                // --- Populate Header ---
                document.getElementById('report-date').textContent = new Date(report.created_at).toLocaleDateString();
                document.getElementById('report-user-name').textContent = report.user_name;

                // --- Populate Overall Score & Risk ---
                const scoreEl = document.getElementById('report-score');
                const riskEl = document.getElementById('report-risk-level');
                scoreEl.textContent = `${report.overall_score}%`;
                if (report.overall_score >= 80) { riskEl.textContent = 'Low Risk'; riskEl.className = 'font-bold text-lg text-green-600'; }
                else if (report.overall_score >= 50) { riskEl.textContent = 'Moderate Risk'; riskEl.className = 'font-bold text-lg text-yellow-600'; }
                else { riskEl.textContent = 'High Risk'; riskEl.className = 'font-bold text-lg text-red-600'; }

                // --- Populate Category Scores ---
                const categoryScoresContainer = document.getElementById('report-category-scores');
                categoryScoresContainer.innerHTML = Object.entries(report.category_scores).map(([name, score]) => `
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-gray-600 capitalize">${name}</span><span class="font-semibold">${score}%</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill" style="width: ${score}%"></div></div>
                    </div>
                `).join('');

                // --- Populate Behavioral Patterns ---
                const patternsContainer = document.getElementById('report-behavioral-patterns');
                patternsContainer.innerHTML = Object.keys(report.behavioral_patterns).length > 0 
                    ? Object.entries(report.behavioral_patterns).map(([name, value]) => `
                        <div class="flex items-center"><i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
                            <div><div class="font-semibold capitalize">${name.replace(/([A-Z])/g, ' $1')}</div><div class="text-sm text-gray-500">Vulnerability detected</div></div>
                        </div>`).join('')
                    : `<p class="text-gray-500 col-span-2">No significant negative behavioral patterns were detected.</p>`;

                // --- Populate Recommendations ---
                const recommendationsContainer = document.getElementById('report-recommendations');
                recommendationsContainer.innerHTML = report.recommendations.map(rec => {
                    let color = 'blue';
                    if (rec.priority === 'critical') color = 'red';
                    if (rec.priority === 'important') color = 'yellow';
                    return `<div class="p-4 rounded-lg border-l-4 border-${color}-500 bg-${color}-50">
                                <div class="font-semibold capitalize">${rec.priority}</div>
                                <p class="text-gray-700">${rec.text}</p>
                            </div>`;
                }).join('');

                // --- Populate Strengths ---
                const strengthsContainer = document.getElementById('report-strengths');
                strengthsContainer.innerHTML = report.strengths.map(s => `<li>${s}</li>`).join('');

                showScreen('report-screen');
            } catch (error) {
                alert(`Could not load report: ${error.message}`);
            }
        }
        
        function initializeApp() {
            ui.login.loginBtn.addEventListener('click', handleLogin);
            ui.logoutBtn.addEventListener('click', handleLogout);
            ui.admin.assignBtn.addEventListener('click', handleAssignAssessment);
            ui.assessment.optionsContainer.addEventListener('click', handleOptionSelect);
            uiReport.backBtn.addEventListener('click', () => {
                renderEmployeeDashboard(); // Refresh dashboard
                showScreen('employee-dashboard');
            });

            document.body.addEventListener('click', (e) => {
                if (e.target.matches('.start-assessment-btn')) {
                    const assignmentId = e.target.dataset.assignmentId;
                    startAssessment(assignmentId);
                }
                if (e.target.matches('.view-report-btn')) {
                    const sessionId = e.target.dataset.sessionId;
                    viewReport(sessionId);
                }
            });
        }
                
        initializeApp();
    </script>
</body>
</html>